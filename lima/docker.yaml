images:
- location: "https://cloud.debian.org/images/cloud/bullseye/20220121-894/debian-11-generic-amd64-20220121-894.qcow2"
  arch: "x86_64"
- location: "https://cloud.debian.org/images/cloud/bullseye/20220121-894/debian-11-generic-arm64-20220121-894.qcow2"
  arch: "aarch64"

cpus: 4
memory: "4G"
disk: "32G"

containerd:
  system: false
  user: false

mounts:
- location: "~"
  writable: false

- location: "/tmp/lima"
  writable: true

provision:
- mode: system
  script: |
    #!/bin/bash
    set -eux -o pipefail

    apt-get update && apt-get install -y \
    ca-certificates gnupg curl lsb-release

    [[ $? -eq 0 ]] && \
    curl -fsSL "https://download.docker.com/linux/debian/gpg" | \
    gpg --dearmor -o "/usr/share/keyrings/docker-archive-keyring.gpg"

    [[ $? -eq 0 ]] && echo \
    "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] \
    https://download.docker.com/linux/debian $(lsb_release -cs) stable" | \
    tee /etc/apt/sources.list.d/docker.list > /dev/null

    [[ $? -eq 0 ]] && apt-get update && apt-get install -y \
    docker-ce docker-ce-cli containerd.io docker-compose

    [[ $? -eq 0 ]] && apt-get clean
